<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>alumbra.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">alumbra</span> <span class="project-version">0.1.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="99-alumbra-components.html"><div class="inner"><span>Components</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="alumbra.core.html"><div class="inner"><span>alumbra.core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="alumbra.core.html#var-executor"><div class="inner"><span>executor</span></div></a></li><li class="depth-1"><a href="alumbra.core.html#var-graphiql-handler"><div class="inner"><span>graphiql-handler</span></div></a></li><li class="depth-1"><a href="alumbra.core.html#var-handler"><div class="inner"><span>handler</span></div></a></li><li class="depth-1"><a href="alumbra.core.html#var-string-validator"><div class="inner"><span>string-validator</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">alumbra.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-executor"><h3>executor</h3><div class="usage"><code>(executor {:keys [schema query mutation subscription engine env scalars directives], :as opts})</code></div><div class="doc"><div class="markdown"><p>Creates a function that takes a query string, as well as an option map, returning the result of running the query.</p>
<pre><code class="clojure">(def run-query
  (alumbra.core/executor
    {:schema (io/resource "Schema.gql")
     :query  QueryRoot}))

(run-query "{ person { name } }")
;; =&gt; {:data {"person" {"name" ...}}}
</code></pre>
<p>Allowed options are:</p>
<ul>
  <li><code>:operation-name</code>: for multi-operation queries, sets the one to execute,</li>
  <li><code>:variables</code>: a map of variable name strings to their value,</li>
  <li><code>:context</code>: a context map to-be-merged into the resolution environment.</li>
</ul>
<p>All <a href="alumbra.core.html#var-handler">handler</a> options (except <code>:context-fn</code>) are suppored.</p></div></div><div class="src-link"><a href="https://github.com/alumbra/alumbra/blob/v0.1.1/src/alumbra/core.clj#L172">view source</a></div></div><div class="public anchor" id="var-graphiql-handler"><h3>graphiql-handler</h3><div class="usage"><code>(graphiql-handler graphql-path &amp; [{:keys [graphiql-version promise-version fetch-version react-version use-cdn? title custom-head-tags], :as opts}])</code></div><div class="doc"><div class="markdown"><p>Generate a Ring handler exposing the interactive <a href="https://github.com/graphql/graphiql">GraphiQL</a> environment, pointing at <code>graphql-path</code>. (Make sure to set the correct CORS options if you’re using an absolute URL.)</p>
<pre><code class="clojure">(alumbra.core/graphiql-handler
  "/people/v1/graphql"
  {:title "People API (GraphiQL)"})
</code></pre>
<p>By default, the static GraphiQL resources will be fetched from a CDN. You can set the respective <code>*-version</code> keys, or disable this completely using <code>:use-cdn?</code>.</p>
<p>You can add custom tags to the <code>&lt;head&gt;</code> element using <code>:custom-head-tags</code>.</p></div></div><div class="src-link"><a href="https://github.com/alumbra/alumbra/blob/v0.1.1/src/alumbra/core.clj#L140">view source</a></div></div><div class="public anchor" id="var-handler"><h3>handler</h3><div class="usage"><code>(handler {:keys [schema query mutation subscription engine env context-fn scalars directives], :as opts})</code></div><div class="doc"><div class="markdown"><p>Generate a Ring handler for GraphQL execution based on the given GraphQL <code>:schema</code>.</p>
<pre><code class="graphql">type Person {
  id: ID!,
  name: String!
}

type QueryRoot {
  person(id: ID!): Person
  me: Person
}

schema {
  query: QueryRoot
}
</code></pre>
<p>The root types defined in the schema have to be given within <code>opts</code>:</p>
<ul>
  <li><code>:query</code> (required)</li>
  <li><code>:mutation</code></li>
  <li><code>:subscription</code></li>
</ul>
<p>Each root type has to be a map associating field names with claro resolvables:</p>
<pre><code class="clojure">(def QueryRoot
  {:person (map-&gt;Person {})
   :me     (map-&gt;Me {})
   ...})
</code></pre>
<p>A basic GraphQL handler thus consists of at least:</p>
<pre><code class="clojure">(alumbra.core/handler
  {:schema (io/resource "Schema.gql")
   :query  QueryRoot})
</code></pre>
<p>Schemas can be given as strings, <code>File</code> or <code>URI</code> values. Multiple schemas can be supplied and will be merged in-order.</p>
<p>A claro resolution environment can be supplied using <code>:env</code>. The environment can be extended using a request-specific <code>:context-fn</code> function, e.g.:</p>
<pre><code class="clojure">(defn context-fn
  [request]
  {:locale  (read-locale request)
   :db      (select-db-for request)
   :session (read-session request)})
</code></pre>
<p>The claro engine to-be-used for resolution can be specified using <code>:engine</code>, allowing for custom engine middlewares to be attached.</p>
<p>Custom directive handlers can be defined in <code>:directives</code>. They’ll take a claro projection and the respective directive arguments, allowing a new projection to be generated. For example, the <code>@skip</code> handler is defined as:</p>
<pre><code class="clojure">{"skip" (fn [projection arguments]
            (when-not (:if arguments)
              projection))}
</code></pre>
<p>Custom scalar handlers can be defined in <code>:scalars</code>, as <code>:encode</code>/<code>:decode</code> pairs.</p>
<pre><code class="clojure">{"NumericalID" {:encode str, :decode #(Long. %)}}
</code></pre>
<p>Note that, for both directives and scalars, the respective schema definitions have to exist.</p></div></div><div class="src-link"><a href="https://github.com/alumbra/alumbra/blob/v0.1.1/src/alumbra/core.clj#L46">view source</a></div></div><div class="public anchor" id="var-string-validator"><h3>string-validator</h3><div class="usage"><code>(string-validator schema)</code></div><div class="doc"><div class="markdown"><p>Generate a validator function that takes GraphQL query document strings as input.</p>
<pre><code class="clojure">(def validate
  (string-validator
    "type Person { id: ID!, name: String!, friends: [Person!] }
     type QueryRoot { person(id: ID!): Person }
     schema { query: QueryRoot }"))
</code></pre>
<p>On successful validation, the validator returns <code>nil</code>.</p></div></div><div class="src-link"><a href="https://github.com/alumbra/alumbra/blob/v0.1.1/src/alumbra/core.clj#L26">view source</a></div></div></div></body></html>